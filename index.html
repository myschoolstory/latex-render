<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeX Math Renderer with KaTeX</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        .katex-display {
            margin: 1em 0;
            overflow-x: auto;
            overflow-y: hidden;
        }
        .command-btn {
            transition: all 0.2s;
        }
        .command-btn:hover {
            transform: translateY(-2px);
        }
        .command-btn:active {
            transform: translateY(0);
        }
        #renderOutput {
            min-height: 100px;
            background: #f9fafb;
            border-radius: 8px;
            padding: 20px;
        }
        .error-output {
            color: #ef4444;
            font-family: monospace;
            font-size: 14px;
        }
        .syntax-fixed {
            background-color: #fef3c7;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">LaTeX Math Renderer</h1>
            <p class="text-gray-600">Powered by KaTeX with automatic syntax fixing</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Command Board -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Command Board</h2>
                    
                    <!-- Basic Operations -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Basic Operations</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="insertCommand('\\frac{}{}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                Fraction
                            </button>
                            <button onclick="insertCommand('\\sqrt{}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                ‚àö Root
                            </button>
                            <button onclick="insertCommand('^{}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                Power
                            </button>
                            <button onclick="insertCommand('_{}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                Subscript
                            </button>
                            <button onclick="insertCommand('\\sum_{i=1}^{n}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                Œ£ Sum
                            </button>
                            <button onclick="insertCommand('\\int_{a}^{b}')" class="command-btn bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">
                                ‚à´ Integral
                            </button>
                        </div>
                    </div>

                    <!-- Greek Letters -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Greek Letters</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="insertCommand('\\alpha')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œ±
                            </button>
                            <button onclick="insertCommand('\\beta')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œ≤
                            </button>
                            <button onclick="insertCommand('\\gamma')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œ≥
                            </button>
                            <button onclick="insertCommand('\\delta')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œ¥
                            </button>
                            <button onclick="insertCommand('\\theta')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œ∏
                            </button>
                            <button onclick="insertCommand('\\lambda')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                Œª
                            </button>
                            <button onclick="insertCommand('\\pi')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                œÄ
                            </button>
                            <button onclick="insertCommand('\\sigma')" class="command-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 text-sm">
                                œÉ
                            </button>
                        </div>
                    </div>

                    <!-- Trigonometric -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Trigonometric</h3>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="insertCommand('\\sin')" class="command-btn bg-purple-500 text-white px-2 py-1 rounded hover:bg-purple-600 text-sm">
                                sin
                            </button>
                            <button onclick="insertCommand('\\cos')" class="command-btn bg-purple-500 text-white px-2 py-1 rounded hover:bg-purple-600 text-sm">
                                cos
                            </button>
                            <button onclick="insertCommand('\\tan')" class="command-btn bg-purple-500 text-white px-2 py-1 rounded hover:bg-purple-600 text-sm">
                                tan
                            </button>
                        </div>
                    </div>

                    <!-- Relations -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Relations</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="insertCommand('\\leq')" class="command-btn bg-orange-500 text-white px-2 py-1 rounded hover:bg-orange-600 text-sm">
                                ‚â§
                            </button>
                            <button onclick="insertCommand('\\geq')" class="command-btn bg-orange-500 text-white px-2 py-1 rounded hover:bg-orange-600 text-sm">
                                ‚â•
                            </button>
                            <button onclick="insertCommand('\\neq')" class="command-btn bg-orange-500 text-white px-2 py-1 rounded hover:bg-orange-600 text-sm">
                                ‚â†
                            </button>
                            <button onclick="insertCommand('\\approx')" class="command-btn bg-orange-500 text-white px-2 py-1 rounded hover:bg-orange-600 text-sm">
                                ‚âà
                            </button>
                        </div>
                    </div>

                    <!-- Advanced -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Advanced</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="insertCommand('\\lim_{x \\to \\infty}')" class="command-btn bg-indigo-500 text-white px-3 py-2 rounded hover:bg-indigo-600 text-sm">
                                Limit
                            </button>
                            <button onclick="insertCommand('\\prod_{i=1}^{n}')" class="command-btn bg-indigo-500 text-white px-3 py-2 rounded hover:bg-indigo-600 text-sm">
                                ‚àè Product
                            </button>
                            <button onclick="insertCommand('\\partial')" class="command-btn bg-indigo-500 text-white px-3 py-2 rounded hover:bg-indigo-600 text-sm">
                                ‚àÇ Partial
                            </button>
                            <button onclick="insertCommand('\\nabla')" class="command-btn bg-indigo-500 text-white px-3 py-2 rounded hover:bg-indigo-600 text-sm">
                                ‚àá Nabla
                            </button>
                        </div>
                    </div>

                    <!-- Matrices -->
                    <div class="mb-4">
                        <h3 class="text-sm font-medium text-gray-600 mb-2">Matrices</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="insertCommand('\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}')" class="command-btn bg-pink-500 text-white px-3 py-2 rounded hover:bg-pink-600 text-sm">
                                ( ) Matrix
                            </button>
                            <button onclick="insertCommand('\\begin{bmatrix} a & b \\\\ c & d \\end{bmatrix}')" class="command-btn bg-pink-500 text-white px-3 py-2 rounded hover:bg-pink-600 text-sm">
                                [ ] Matrix
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editor and Output -->
            <div class="lg:col-span-2">
                <!-- LaTeX Input -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-700">LaTeX Input</h2>
                        <div class="flex gap-2">
                            <button onclick="fixSyntax()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 text-sm font-medium">
                                üîß Fix Syntax
                            </button>
                            <button onclick="clearInput()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 text-sm font-medium">
                                Clear
                            </button>
                        </div>
                    </div>
                    <textarea 
                        id="latexInput" 
                        class="w-full p-4 border-2 border-gray-200 rounded-lg font-mono text-sm focus:outline-none focus:border-blue-400"
                        rows="8"
                        placeholder="Enter LaTeX code here... Example: \frac{1}{2} + \sqrt{x^2 + y^2}"
                        oninput="renderMath()">E = mc^2</textarea>
                    
                    <div class="mt-3 flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" id="autoRender" checked class="mr-2">
                            <span class="text-sm text-gray-600">Auto-render on type</span>
                        </label>
                        <button onclick="renderMath()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 font-medium">
                            Render Math
                        </button>
                    </div>
                </div>

                <!-- Rendered Output -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Rendered Output</h2>
                    <div id="syntaxFixNotice"></div>
                    <div id="renderOutput" class="text-2xl text-center"></div>
                </div>

                <!-- Examples -->
                <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Examples</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <button onclick="loadExample('\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}')" class="text-left p-3 bg-gray-100 rounded hover:bg-gray-200 transition">
                            <div class="font-medium text-sm text-gray-700">Quadratic Formula</div>
                        </button>
                        <button onclick="loadExample('\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}')" class="text-left p-3 bg-gray-100 rounded hover:bg-gray-200 transition">
                            <div class="font-medium text-sm text-gray-700">Sum Formula</div>
                        </button>
                        <button onclick="loadExample('\\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}')" class="text-left p-3 bg-gray-100 rounded hover:bg-gray-200 transition">
                            <div class="font-medium text-sm text-gray-700">Gaussian Integral</div>
                        </button>
                        <button onclick="loadExample('\\nabla \\times \\vec{F} = \\left( \\frac{\\partial F_z}{\\partial y} - \\frac{\\partial F_y}{\\partial z} \\right) \\hat{i}')" class="text-left p-3 bg-gray-100 rounded hover:bg-gray-200 transition">
                            <div class="font-medium text-sm text-gray-700">Vector Calculus</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Automatic syntax fixer for common LaTeX mistakes
        function fixSyntax() {
            const input = document.getElementById('latexInput');
            let latex = input.value;
            const originalLatex = latex;
            const fixes = [];

            // Fix unmatched braces
            let openBraces = (latex.match(/{/g) || []).length;
            let closeBraces = (latex.match(/}/g) || []).length;
            if (openBraces > closeBraces) {
                latex += '}}'.repeat(openBraces - closeBraces);
                fixes.push(`Added ${openBraces - closeBraces} closing brace(s)`);
            } else if (closeBraces > openBraces) {
                latex = '{{'.repeat(closeBraces - openBraces) + latex;
                fixes.push(`Added ${closeBraces - openBraces} opening brace(s)`);
            }

            // Fix unmatched parentheses in \left( and \right)
            const leftParens = (latex.match(/\\left\(/g) || []).length;
            const rightParens = (latex.match(/\\right\)/g) || []).length;
            if (leftParens > rightParens) {
                latex += '\\right)'.repeat(leftParens - rightParens);
                fixes.push(`Added ${leftParens - rightParens} \\right)`);
            }

            // Fix common typos
            const typoFixes = [
                { from: /\\frac(?!{)/g, to: '\\frac{}{}', fix: 'Fixed incomplete \\frac' },
                { from: /\\sqrt(?!{)/g, to: '\\sqrt{}', fix: 'Fixed incomplete \\sqrt' },
                { from: /\^(?!{)(.)/g, to: '^{$1}', fix: 'Added braces to superscript' },
                { from: /_(?!{)(.)/g, to: '_{$1}', fix: 'Added braces to subscript' },
                { from: /\\sin(?!\s|\\|_|\^|$)/g, to: '\\sin ', fix: 'Added space after \\sin' },
                { from: /\\cos(?!\s|\\|_|\^|$)/g, to: '\\cos ', fix: 'Added space after \\cos' },
                { from: /\\tan(?!\s|\\|_|\^|$)/g, to: '\\tan ', fix: 'Added space after \\tan' },
                { from: /\\log(?!\s|\\|_|\^|$)/g, to: '\\log ', fix: 'Added space after \\log' },
                { from: /\\ln(?!\s|\\|_|\^|$)/g, to: '\\ln ', fix: 'Added space after \\ln' },
                { from: /\*/g, to: '\\cdot', fix: 'Replaced * with \\cdot' },
                { from: /\.\.\./g, to: '\\ldots', fix: 'Replaced ... with \\ldots' },
                { from: /\+-/g, to: '\\pm', fix: 'Replaced +- with \\pm' },
                { from: />=/g, to: '\\geq', fix: 'Replaced >= with \\geq' },
                { from: /<=/g, to: '\\leq', fix: 'Replaced <= with \\leq' },
                { from: /!=/g, to: '\\neq', fix: 'Replaced != with \\neq' },
                { from: /\s+/g, to: ' ', fix: 'Normalized whitespace' }
            ];

            typoFixes.forEach(({ from, to, fix }) => {
                const before = latex;
                latex = latex.replace(from, to);
                if (before !== latex) {
                    fixes.push(fix);
                }
            });

            // Fix missing backslashes for common commands
            const commonCommands = ['alpha', 'beta', 'gamma', 'delta', 'theta', 'pi', 'sigma', 'lambda', 'infty'];
            commonCommands.forEach(cmd => {
                const regex = new RegExp(`(?<!\\\\)\\b${cmd}\\b`, 'g');
                const before = latex;
                latex = latex.replace(regex, `\\${cmd}`);
                if (before !== latex) {
                    fixes.push(`Added backslash to ${cmd}`);
                }
            });

            // Update input if changes were made
            if (latex !== originalLatex) {
                input.value = latex;
                
                // Show fixes notice
                const noticeDiv = document.getElementById('syntaxFixNotice');
                if (fixes.length > 0) {
                    noticeDiv.innerHTML = `
                        <div class="syntax-fixed">
                            <strong>‚úì Syntax fixed:</strong> ${fixes.join(', ')}
                        </div>
                    `;
                    setTimeout(() => {
                        noticeDiv.innerHTML = '';
                    }, 5000);
                }
                
                renderMath();
            } else {
                const noticeDiv = document.getElementById('syntaxFixNotice');
                noticeDiv.innerHTML = `
                    <div class="bg-green-100 text-green-700 p-3 rounded mb-3">
                        ‚úì No syntax errors detected
                    </div>
                `;
                setTimeout(() => {
                    noticeDiv.innerHTML = '';
                }, 3000);
            }
        }

        // Insert command at cursor position
        function insertCommand(command) {
            const input = document.getElementById('latexInput');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            
            input.value = text.substring(0, start) + command + text.substring(end);
            
            // Place cursor after the inserted command or inside first braces
            const firstBrace = command.indexOf('{');
            if (firstBrace !== -1) {
                input.selectionStart = input.selectionEnd = start + firstBrace + 1;
            } else {
                input.selectionStart = input.selectionEnd = start + command.length;
            }
            
            input.focus();
            renderMath();
        }

        // Render LaTeX to math
        function renderMath() {
            const autoRender = document.getElementById('autoRender').checked;
            if (!autoRender && event && event.type === 'input') {
                return;
            }

            const latex = document.getElementById('latexInput').value;
            const output = document.getElementById('renderOutput');
            
            try {
                katex.render(latex, output, {
                    displayMode: true,
                    throwOnError: false,
                    errorColor: '#cc0000'
                });
            } catch (e) {
                output.innerHTML = `<div class="error-output">Error: ${e.message}</div>`;
            }
        }

        // Clear input
        function clearInput() {
            document.getElementById('latexInput').value = '';
            document.getElementById('renderOutput').innerHTML = '';
            document.getElementById('syntaxFixNotice').innerHTML = '';
        }

        // Load example
        function loadExample(latex) {
            document.getElementById('latexInput').value = latex;
            renderMath();
        }

        // Initial render
        document.addEventListener('DOMContentLoaded', function() {
            renderMath();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter to render
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                renderMath();
            }
            // Ctrl/Cmd + F to fix syntax
            if ((e.ctrlKey || e.metaKey) && e.key === 'f' && !e.shiftKey) {
                e.preventDefault();
                fixSyntax();
            }
        });
    </script>
</body>
</html>
